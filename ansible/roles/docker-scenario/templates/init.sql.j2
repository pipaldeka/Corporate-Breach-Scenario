-- ansible/roles/docker-scenario/templates/init.sql.j2
-- ====================================================
-- PURPOSE: Database initialization with dynamic flag
-- GENERATED BY: Ansible template engine
-- ====================================================

CREATE DATABASE IF NOT EXISTS {{ db_name }};
USE {{ db_name }};

CREATE TABLE IF NOT EXISTS users (
    id INT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) NOT NULL,
    password VARCHAR(50) NOT NULL,
    role VARCHAR(20) NOT NULL,
    email VARCHAR(100)
);

CREATE TABLE IF NOT EXISTS flags (
    flag_id INT PRIMARY KEY,
    flag_value VARCHAR(100) NOT NULL,
    description TEXT
);

-- Insert sample users
INSERT INTO users (username, password, role, email) VALUES
('john', 'john123', 'user', 'john@example.com'),
('alice', 'alice456', 'user', 'alice@example.com'),
('admin', 'impossible_password_12345', 'admin', 'admin@example.com');

-- Insert flag (unique per student)
INSERT INTO flags (flag_id, flag_value, description) VALUES
(1, '{{ flag }}', 'Main challenge flag for {{ student_id }}');

SELECT 'Database initialized successfully!' AS message;
